## Chrome 插件「easy-trans」产品需求文档（PRD）

### 一、产品概述
- **产品名称**: easy-trans
- **一句话定位**: 在网页中按住快捷键用鼠标框选截图，离线 OCR 提取中英文文本，并调用 Kimi 大模型进行中英互译，在同一浮窗中展示识别与翻译结果。
- **目标**: 帮助用户在浏览网页时快捷获取图片/非可选文本中的中英文内容，并立即得到对向语言翻译结果，提升阅读与信息获取效率。

### 二、目标用户与使用场景
- **目标用户**:
  - 经常浏览含图片文本内容的网站的学习者、研究者、跨境工作者。
  - 需要快速中英互译的内容消费者（技术文档、论文、资讯、社媒截图等）。
- **核心场景**:
  - 在网页上遇到图片上的英文段落，想快速获取中文翻译。
  - 在网页上遇到中文截图或扫描件，想快速转成可复制的英文内容。
  - 对页面中无法直接复制的文字（如画布、视频帧、PDF Canvas）进行 OCR 与翻译。

### 三、产品目标与非目标
- **产品目标**:
  - 提供稳定、低门槛、可定制的“截图→OCR→翻译→结果展示”一体化流程。
  - 离线优先的 OCR（Tesseract），仅将识别出的文本发送给大模型进行翻译。
  - 支持中英互相转换（自动识别源语言并翻译为另一种）。

### 四、核心功能需求
1) **截图与触发方式**
   - 默认按住快捷键 `Shift` + 鼠标左键拖拽，进入全屏半透明遮罩，绘制矩形选区。
   - 支持 `Esc` 取消。
   - 仅捕获当前标签页的可见区域；对隐藏区域不支持滚动拼接（见约束）。
   - 选区完成后自动截取该区域图像供 OCR。

2) **OCR 识别（Tesseract）**
   - 语言包随扩展打包，包含 `eng` 与 `chi_sim`；默认自动同时加载以提升中英混排识别率。
   - 语言包启用状态与版本信息使用 `chrome.storage.sync` 同步；无需网络下载语言包本体。
   - 在浏览器端以 WebAssembly 运行，离线识别，无需上传图片到云端。
   - 识别完成后在结果浮窗展示“原文”文本，保留基础换行与空白符。

3) **翻译（Kimi 大模型）**
   - 固定模型：`baseUrl: https://api.moonshot.cn/v1`，`model: kimi-k2-0905-preview`。
   - 将 OCR 文本作为输入传给大模型，自动识别源语言为中/英并翻译为对向语言。
   - 支持在设置中配置 API Key；请求需有超时与错误重试（见体验与错误处理）。

4) **结果展示（同一窗口）**
   - 使用同一浮窗展示上下分栏：上为“识别原文”，下为“翻译结果”。
   - 交互控件：复制原文、复制译文、重新识别、重新翻译、编辑原文后再次翻译。
   - 支持一键清空本次结果、关闭浮窗。

5) **历史记录（可选，首版简化）**
   - 默认保存最近 N 次（如 10 次）识别与翻译内容（仅文本，不含图片）到 `chrome.storage.sync`；配额不足时回退到 `chrome.storage.local`。
   - 从扩展弹窗（Popup）进入历史列表，支持复制与删除。

### 五、设置与可配置项
1) **模型 API Key**
   - 输入并本地安全存储（`chrome.storage.local`，不随账号同步）。

2) **快捷键设置**
   - 默认按住 `Shift` 进入截图模式。
   - 可修改为 `Ctrl`/`Alt`/`Shift` 的组合（需避免与常见页面快捷键冲突）。
   - 提供“恢复默认”按钮。

3) **提示词（Prompt）设置**
   - 提供默认提示词，支持用户自定义与“恢复默认”。
   - 默认提示词建议：
```
你是精准的中英互译助手。请自动判断输入文本是中文还是英文，并翻译成另一种语言。务必：
1) 忠实准确，保持术语一致与专有名词原意；
2) 保留行文格式与换行；
3) 数字、单位、代码片段原样保留；
4) 仅输出译文，不要添加解释或前后缀。
```

4) **语言策略**
   - 默认为“自动识别→翻译为对向语言”。
   - 主导语言判定：按字符占比与句段权重统计主导语言（中文字符、英文单词分别计数）。
   - 输出语言：对向于主导语言。若句段中存在与目标语言相同的部分，则这些部分保持原样，不重复翻译。
   - 术语与专有名词（如 API 名称、产品名）在译文中尽量保留原文。
   - 代码片段处理：对 ```...```、`...` 内内容、URL、文件路径、命令行、标识符（camelCase/snake_case/PascalCase）一律不翻译，仅翻译其前后自然语言。

5) **OCR 语言包管理**
   - 语言包随扩展打包：预置 `eng`、`chi_sim`；首次使用无需下载，按需加载并缓存加载状态。
   - 设置中可查看语言包加载状态与占用体积。
   - 加载状态、启用语言与版本等通过 `chrome.storage.sync` 同步。

### 六、关键用户流程
1) **首次使用**
   - 安装完成后，从 Popup 进入设置，提示填写 Kimi API Key。
   
2) **截图→识别→翻译**
   - 用户按住快捷键 `Shift` → 鼠标拖拽框选 → 松开完成选区。
   - 系统捕获当前页可见区图像并裁剪选区 → Tesseract OCR → 展示“原文”。
   - 自动调用 Kimi 翻译 → 展示“译文”。
   - 用户可复制、编辑后再次翻译、或关闭。

3) **错误处理体验设计**

#### 3.1 错误分类与展示策略

**错误等级分类：**

1. **提示级（Info）** - 轻微问题，不影响核心功能
2. **警告级（Warning）** - 功能部分受限，但可继续使用
3. **错误级（Error）** - 核心功能失败，需要用户干预
4. **严重级（Critical）** - 系统异常，无法继续使用

#### 3.2 特殊场景处理

**网络状态监控：**
- 检测网络断开，提示"网络连接已断开"
- 网络恢复时自动重试失败的操作
- 离线时禁用需要网络的功能

**大文件处理：**
- 图片大于5MB时提示"图片较大，处理需要时间"
- 显示处理进度条
- 支持取消操作

**并发限制：**
- 同时只能进行一个 OCR/翻译任务
- 新操作时提示"正在处理中，请稍候"

#### 33用户引导

**首次使用引导：**
- 清晰说明 API Key 配置步骤
- 提供截图操作演示
- 说明常见错误及解决方法

### 七、界面与交互规范
1) **截图遮罩层**
   - 全屏半透明黑遮罩；选区内清晰可见。
   - 选区边框与四角手柄可拖拽微调；支持移动选区。
   - 顶部或附近悬浮工具条：取消、完成。

2) **结果浮窗**
   - 跟随选区出现在页面中，不遮挡关键内容，可拖拽移动、右下角可缩放。
   - 展示加载进度（OCR 进度、翻译进度），完成后显示文本。
   - 操作按钮：复制原文、复制译文、编辑原文、重试、关闭。

3) **扩展弹窗（Popup）**
   - 入口：设置、历史记录（可选）、使用说明。
   - 设置项分组：API Key、快捷键、提示词、语言策略、OCR 语言包状态。

### 八、技术与平台约束（产品可见）
- **Manifest**: 使用 Manifest V3。
- **权限（最小化）**:
  - `activeTab`：访问当前活动标签页用于截图。
  - `tabs`：`captureVisibleTab` 截屏可见区域。
  - `scripting`：注入内容脚本（遮罩、浮窗）。
  - `storage`：保存设置与历史记录。
  - `commands`：注册可配置快捷键（辅助打开截图模式）。
- **页面限制**:
  - 无法作用于 Chrome 内置页面、扩展商店等受限域名。
  - 文件协议（`file://`）需用户手动开启访问权限。

### 九、性能与质量指标
- **可用性**:
  - 常规选区识别（1080p 内）≤ 2.5s（中英混排）。
  - 翻译返回 ≤ 3s（网络与模型可用性正常）。
- **准确性**:
  - 中英文常见字体、常见截图清晰度下 OCR 误差率可接受（以体验为准）。
- **稳定性**:
  - OCR 与翻译失败可重试；错误信息清晰可见。

### 十、隐私与合规
- 图片仅在本地进行 OCR，不上传至服务器。
- 仅将识别出的文本发送至 Kimi 接口进行翻译。
- API Key 仅本地存储。
- 提供隐私说明与开源第三方许可（Tesseract）。





